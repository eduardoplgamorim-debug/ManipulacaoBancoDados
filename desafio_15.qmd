---
title: "Desafio 15"
format: html
editor: visual
---

```{julia}
# 1. Carregamos o Polyester
using Polyester 

# Função serial (continua igual)
function calcular_serial!(resultado, dados)
    for i in eachindex(dados)
        resultado[i] = sin(dados[i])
    end
end

# 2. Função "paralela" agora usa @batch
function calcular_polyester!(resultado, dados)
    # Note que trocamos Threads.@threads por @batch
    @batch for i in eachindex(dados)
        resultado[i] = sin(dados[i])
    end
end

# --- Preparação ---
tamanho = 20_000_000 
dados = rand(tamanho)
resultado_serial = similar(dados)
resultado_polyester = similar(dados)

# 3. Note que nthreads() aqui vai dar 1, e TUDO BEM!
println("Iniciando teste (Polyester não precisa de -t)...")
println("Tamanho dos dados: ", tamanho, " elementos.\n")

# --- Teste Serial ---
println("Executando loop serial:")
@time calcular_serial!(resultado_serial, dados)
@time calcular_serial!(resultado_serial, dados) 

println("\nExecutando loop com Polyester (@batch):")
# --- Teste com Polyester ---
@time calcular_polyester!(resultado_polyester, dados)
@time calcular_polyester!(resultado_polyester, dados) 

println("\nResultados são idênticos? ", resultado_serial == resultado_polyester)
println("--- Teste concluído ---")
```

```{r}
#| echo: false
agora <- Sys.time()

# Mostra
cat("Arquivo compilado em:", format(agora, "%d/%m/%Y %H:%M:%S"), "\n")
```
